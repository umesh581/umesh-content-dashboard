<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Umesh ‚Äî Content Engine</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --surface: #111;
  --surface2: #1a1a1a;
  --border: #222;
  --accent: #ff6b2b;
  --accent2: #ffb347;
  --growth: #22c55e;
  --revenue: #f59e0b;
  --purple: #a78bfa;
  --text: #f0f0f0;
  --muted: #666;
  --muted2: #444;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { font-size:16px; }
body { background:var(--bg); color:var(--text); font-family:'DM Sans',sans-serif; min-height:100vh; overflow-x:hidden; }

/* HEADER */
header {
  padding:16px 24px;
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  border-bottom:1px solid var(--border);
  position:sticky; top:0;
  background:rgba(10,10,10,0.96);
  backdrop-filter:blur(12px);
  z-index:100;
}
.logo { display:flex; align-items:center; gap:10px; }
.logo-mark { width:34px; height:34px; background:var(--accent); border-radius:7px; display:flex; align-items:center; justify-content:center; font-family:'Bebas Neue',sans-serif; font-size:17px; color:white; flex-shrink:0; }
.logo-text { font-family:'Bebas Neue',sans-serif; font-size:18px; letter-spacing:2px; }
.logo-sub { font-size:10px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; }
.header-right { display:flex; align-items:center; gap:8px; flex-shrink:0; }
.date-chip { font-family:'DM Mono',monospace; font-size:11px; color:var(--muted); background:var(--surface); border:1px solid var(--border); padding:5px 10px; border-radius:100px; white-space:nowrap; }
.key-btn { font-size:11px; color:var(--muted); background:var(--surface); border:1px solid var(--border); padding:5px 10px; border-radius:100px; cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .15s; white-space:nowrap; }
.key-btn:hover { color:var(--text); border-color:var(--muted); }

/* MAIN */
main { max-width:900px; margin:0 auto; padding:28px 20px 80px; }

/* HERO */
.hero { margin-bottom:28px; }
.hero h1 { font-family:'Bebas Neue',sans-serif; font-size:clamp(40px,8vw,72px); line-height:.95; letter-spacing:2px; margin-bottom:10px; }
.hero h1 span { color:var(--accent); }
.hero p { color:var(--muted); font-size:14px; max-width:420px; line-height:1.6; }

/* INPUT PANEL */
.input-panel { background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:20px; margin-bottom:28px; }
.input-panel-title { font-family:'Bebas Neue',sans-serif; font-size:15px; letter-spacing:2px; color:var(--muted); margin-bottom:16px; text-transform:uppercase; }
.input-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:12px; }
.input-group label { display:block; font-size:10px; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); margin-bottom:6px; font-weight:500; }
.input-group select, .input-group input, .input-group textarea {
  width:100%; background:var(--surface2); border:1px solid var(--border);
  border-radius:7px; padding:10px 12px; color:var(--text);
  font-family:'DM Sans',sans-serif; font-size:13px; outline:none;
  transition:border-color .2s; -webkit-appearance:none;
}
.input-group select:focus, .input-group input:focus, .input-group textarea:focus { border-color:var(--accent); }
.input-group select option { background:#1a1a1a; }
.input-group textarea { resize:none; height:72px; line-height:1.5; }
.input-group textarea::placeholder { color:var(--muted2); }
.gen-btn {
  width:100%; background:var(--accent); color:white; border:none;
  border-radius:9px; padding:14px; font-family:'Bebas Neue',sans-serif;
  font-size:18px; letter-spacing:3px; cursor:pointer;
  transition:all .2s; display:flex; align-items:center; justify-content:center; gap:8px;
}
.gen-btn:hover { background:#ff5500; transform:translateY(-1px); }
.gen-btn:active { transform:translateY(0); }
.gen-btn:disabled { background:var(--muted2); cursor:not-allowed; transform:none; }

/* LOADING */
.loading { text-align:center; padding:48px 20px; display:none; }
.spin { width:40px; height:40px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 12px; }
@keyframes spin { to { transform:rotate(360deg); } }
.loading p { color:var(--muted); font-size:13px; font-style:italic; }

/* ERROR */
.error-box { background:rgba(239,68,68,.08); border:1px solid rgba(239,68,68,.2); border-radius:9px; padding:14px 18px; color:#f87171; font-size:13px; display:none; margin-bottom:16px; }

/* RESULTS */
.results { display:none; }
.results-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; flex-wrap:wrap; gap:8px; }
.results-header h2 { font-family:'Bebas Neue',sans-serif; font-size:24px; letter-spacing:2px; }
.results-meta { font-size:11px; color:var(--muted); font-family:'DM Mono',monospace; }

/* SECTION */
.section { margin-bottom:28px; animation:fadeUp .4s ease forwards; opacity:0; }
.section:nth-child(1){animation-delay:.05s} .section:nth-child(2){animation-delay:.1s}
.section:nth-child(3){animation-delay:.15s} .section:nth-child(4){animation-delay:.2s}
@keyframes fadeUp { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }
.section-header { display:flex; align-items:center; gap:8px; margin-bottom:12px; padding-bottom:10px; border-bottom:1px solid var(--border); }
.section-icon { font-size:16px; }
.section-title { font-family:'Bebas Neue',sans-serif; font-size:16px; letter-spacing:2px; color:var(--muted); text-transform:uppercase; }
.section-count { margin-left:auto; font-size:10px; color:var(--muted2); font-family:'DM Mono',monospace; background:var(--surface2); padding:2px 7px; border-radius:4px; }

/* IDEA CARDS */
.ideas-grid { display:flex; flex-direction:column; gap:7px; }
.idea-card {
  background:var(--surface); border:1px solid var(--border); border-radius:9px;
  padding:12px 14px; display:flex; align-items:flex-start; gap:10px;
  position:relative; overflow:hidden; transition:all .15s;
}
.idea-card::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background:transparent; transition:background .15s; }
.idea-card:hover { border-color:var(--muted2); background:var(--surface2); }
.idea-card.growth::before { background:var(--growth); }
.idea-card.revenue::before { background:var(--revenue); }
.idea-type { flex-shrink:0; font-size:9px; font-weight:600; letter-spacing:1px; text-transform:uppercase; padding:3px 7px; border-radius:4px; margin-top:2px; font-family:'DM Mono',monospace; }
.idea-type.growth { background:rgba(34,197,94,.12); color:var(--growth); border:1px solid rgba(34,197,94,.2); }
.idea-type.revenue { background:rgba(245,158,11,.12); color:var(--revenue); border:1px solid rgba(245,158,11,.2); }
.idea-type.neutral { background:rgba(255,255,255,.05); color:var(--muted); border:1px solid var(--border); }
.idea-text { font-size:14px; line-height:1.4; color:var(--text); flex:1; }
.idea-angle { font-size:11px; color:var(--muted); margin-top:4px; }
.idea-actions { display:flex; gap:5px; margin-top:7px; flex-wrap:wrap; }
.chip-btn { font-size:11px; color:var(--muted); background:none; border:1px solid var(--border); border-radius:4px; padding:3px 8px; cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .15s; white-space:nowrap; }
.chip-btn:hover { color:var(--text); border-color:var(--muted); }
.chip-btn.script { color:var(--accent); border-color:#ff6b2b44; }
.chip-btn.script:hover { background:#ff6b2b11; border-color:var(--accent); }

/* SHORTS */
.shorts-grid { display:grid; grid-template-columns:1fr 1fr; gap:9px; }
.short-card { background:var(--surface); border:1px solid var(--border); border-radius:9px; padding:14px; transition:all .15s; }
.short-card:hover { border-color:var(--muted2); background:var(--surface2); }
.micro-label { font-size:9px; color:var(--muted); font-family:'DM Mono',monospace; letter-spacing:1px; text-transform:uppercase; margin-bottom:6px; }
.short-hook { font-size:13px; line-height:1.5; color:var(--text); font-weight:500; margin-bottom:8px; }
.short-concept { font-size:12px; color:var(--muted); line-height:1.5; }

/* HOOKS */
.hooks-list { display:flex; flex-direction:column; gap:8px; }
.hook-card { background:var(--surface); border:1px solid var(--border); border-left:2px solid var(--accent); border-radius:0 9px 9px 0; padding:14px 16px; font-size:13px; line-height:1.7; color:var(--text); font-style:italic; transition:all .15s; }
.hook-card:hover { background:var(--surface2); }

/* SAVED */
.saved-section { margin-top:40px; padding-top:28px; border-top:1px solid var(--border); display:none; }
.saved-section h3 { font-family:'Bebas Neue',sans-serif; font-size:18px; letter-spacing:2px; color:var(--muted); margin-bottom:14px; }
.saved-list { display:flex; flex-direction:column; gap:7px; }
.saved-item { background:var(--surface); border:1px solid var(--border); border-radius:7px; padding:10px 14px; display:flex; align-items:center; justify-content:space-between; gap:12px; }
.saved-item span { font-size:13px; color:var(--text); flex:1; }
.rm-btn { background:none; border:none; color:var(--muted); cursor:pointer; font-size:15px; padding:2px 6px; transition:color .15s; }
.rm-btn:hover { color:#ef4444; }

/* TOAST */
.toast { position:fixed; bottom:24px; left:50%; transform:translateX(-50%) translateY(60px); background:var(--surface2); border:1px solid var(--border); border-radius:7px; padding:9px 18px; font-size:12px; color:var(--text); z-index:999; transition:transform .3s ease; pointer-events:none; white-space:nowrap; }
.toast.show { transform:translateX(-50%) translateY(0); }

/* ===== SCRIPT PANEL ===== */
.script-overlay { position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:200; display:none; backdrop-filter:blur(4px); }
.script-panel {
  position:fixed; top:0; right:-110%; width:min(680px,100vw); height:100vh;
  background:#0d0d0d; border-left:1px solid var(--border);
  z-index:201; transition:right .35s cubic-bezier(.4,0,.2,1);
  display:flex; flex-direction:column; overflow:hidden;
}
.script-panel.open { right:0; }
.sp-header { padding:16px 20px; border-bottom:1px solid var(--border); display:flex; align-items:flex-start; gap:12px; flex-shrink:0; }
.sp-title-box { flex:1; min-width:0; }
.sp-label { font-size:9px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); font-family:'DM Mono',monospace; margin-bottom:4px; }
.sp-title { font-family:'Bebas Neue',sans-serif; font-size:18px; letter-spacing:1px; color:var(--text); line-height:1.2; word-break:break-word; }
.sp-close { background:none; border:1px solid var(--border); color:var(--muted); width:30px; height:30px; border-radius:5px; cursor:pointer; font-size:14px; flex-shrink:0; transition:all .15s; }
.sp-close:hover { color:var(--text); border-color:var(--muted); }
.sp-actions { padding:10px 20px; border-bottom:1px solid var(--border); display:flex; gap:7px; flex-shrink:0; flex-wrap:wrap; }
.sp-btn { font-size:11px; padding:6px 12px; border-radius:5px; border:1px solid var(--border); background:var(--surface); color:var(--text); cursor:pointer; font-family:'DM Sans',sans-serif; transition:all .15s; white-space:nowrap; }
.sp-btn:hover { border-color:var(--muted); background:var(--surface2); }
.sp-btn.primary { background:var(--accent); border-color:var(--accent); color:white; }
.sp-btn.primary:hover { background:#ff5500; }
.sp-btn.tp { background:#1e1535; border-color:#a78bfa44; color:var(--purple); }
.sp-btn.tp:hover { background:#2a1d4a; border-color:var(--purple); }
.sp-body { flex:1; overflow-y:auto; padding:20px; }
.sp-body::-webkit-scrollbar { width:3px; }
.sp-body::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
.sp-loading { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:14px; }
.sp-loading p { color:var(--muted); font-size:12px; font-style:italic; text-align:center; line-height:1.7; }
.script-part { margin-bottom:24px; animation:fadeUp .4s ease forwards; opacity:0; }
.script-part:nth-child(1){animation-delay:.05s}.script-part:nth-child(2){animation-delay:.1s}
.script-part:nth-child(3){animation-delay:.15s}.script-part:nth-child(4){animation-delay:.2s}
.script-part:nth-child(5){animation-delay:.25s}.script-part:nth-child(6){animation-delay:.3s}
.script-part:nth-child(7){animation-delay:.35s}
.part-head { display:flex; align-items:center; gap:8px; margin-bottom:10px; flex-wrap:wrap; }
.part-badge { font-family:'DM Mono',monospace; font-size:9px; letter-spacing:1px; padding:2px 7px; border-radius:3px; background:var(--surface2); border:1px solid var(--border); color:var(--muted); text-transform:uppercase; }
.part-name { font-family:'Bebas Neue',sans-serif; font-size:14px; letter-spacing:1.5px; text-transform:uppercase; }
.part-timing { margin-left:auto; font-size:10px; color:var(--muted2); font-family:'DM Mono',monospace; }
.script-text { font-size:13px; line-height:1.95; color:#ccc; white-space:pre-wrap; border-left:2px solid var(--border); padding-left:14px; }
.script-text b { color:var(--accent2); font-weight:600; }
.script-text i { color:var(--muted); font-style:italic; font-size:11px; }
.part-divider { height:1px; background:var(--surface2); margin-bottom:24px; }
.sp-footer { padding:10px 20px; border-top:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; flex-shrink:0; background:var(--surface); }
.sp-footer span { font-size:11px; color:var(--muted); font-family:'DM Mono',monospace; }
.sp-wc { color:var(--growth); font-weight:500; }

/* ===== TELEPROMPTER ===== */
#tp {
  position:fixed; inset:0; background:#000; z-index:300;
  display:none; flex-direction:column; overflow:hidden;
  touch-action:none;
}
#tp-bar {
  position:absolute; top:0; left:0; right:0; z-index:10;
  padding:12px 20px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:8px;
  background:linear-gradient(to bottom,rgba(0,0,0,.95),transparent);
  transition:opacity .4s;
}
#tp-progress { position:absolute; top:0; left:0; right:0; height:3px; background:#111; z-index:11; }
#tp-prog-fill { height:100%; background:var(--purple); width:0%; transition:width .15s; }
#tp-fade-top { position:absolute; top:0; left:0; right:0; height:160px; background:linear-gradient(to bottom,#000,transparent); z-index:6; pointer-events:none; }
#tp-fade-bot { position:absolute; bottom:0; left:0; right:0; height:160px; background:linear-gradient(to top,#000,transparent); z-index:6; pointer-events:none; }
#tp-line { position:absolute; left:0; right:0; top:50%; height:1px; background:rgba(167,139,250,.12); z-index:5; pointer-events:none; }
#tp-scroller { height:100%; overflow:hidden; position:relative; }
#tp-text {
  padding:50vh 8vw 80vh;
  max-width:820px; margin:0 auto;
  font-family:'DM Sans',sans-serif; font-size:36px; font-weight:400;
  line-height:1.85; color:#f0f0f0;
  will-change:transform;
}
#tp-text .tp-section-label { font-family:'Bebas Neue',sans-serif; font-size:.55em; letter-spacing:3px; color:var(--purple); margin:1.2em 0 .3em; opacity:.6; display:block; }
#tp-text p { margin:0 0 .5em; }
#tp-controls {
  position:absolute; bottom:0; left:0; right:0; z-index:10;
  padding:16px 20px; display:flex; align-items:center; justify-content:center; gap:12px; flex-wrap:wrap;
  background:linear-gradient(to top,rgba(0,0,0,.95),transparent);
  transition:opacity .4s;
}
.tp-ctrl-group { display:flex; align-items:center; gap:6px; }
.tp-ctrl-label { font-size:10px; color:var(--muted); font-family:'DM Mono',monospace; letter-spacing:1px; }
.tp-btn { background:#111; border:1px solid #333; color:#f0f0f0; width:32px; height:32px; border-radius:5px; cursor:pointer; font-size:13px; display:flex; align-items:center; justify-content:center; transition:all .15s; -webkit-appearance:none; }
.tp-btn:hover { background:#222; border-color:#555; }
.tp-val { font-family:'DM Mono',monospace; font-size:12px; color:var(--purple); min-width:28px; text-align:center; }
#tp-play {
  background:var(--purple); border:none; color:white;
  width:52px; height:52px; border-radius:50%; cursor:pointer; font-size:20px;
  display:flex; align-items:center; justify-content:center;
  transition:all .15s; box-shadow:0 0 20px rgba(167,139,250,.3);
  -webkit-appearance:none;
}
#tp-play:hover { background:#7c3aed; }
#tp-play.playing { background:#7c3aed; }
.tp-time { font-family:'DM Mono',monospace; font-size:11px; color:#444; }
#tp-hint { position:absolute; bottom:90px; left:50%; transform:translateX(-50%); font-size:10px; color:#2a2a2a; font-family:'DM Mono',monospace; letter-spacing:1px; pointer-events:none; transition:opacity .4s; white-space:nowrap; }
.tp-exit { background:rgba(255,255,255,.05); border:1px solid #333; color:#aaa; padding:6px 14px; border-radius:5px; cursor:pointer; font-size:12px; font-family:'DM Sans',sans-serif; transition:all .15s; -webkit-appearance:none; }
.tp-exit:hover { background:rgba(255,255,255,.1); }

/* MOBILE */
@media(max-width:640px) {
  .input-grid { grid-template-columns:1fr 1fr; }
  .input-grid .input-group:last-child { grid-column:1/-1; }
  .shorts-grid { grid-template-columns:1fr; }
  .header-right .date-chip { display:none; }
  #tp-text { font-size:26px; padding:50vh 6vw; }
  .tp-ctrl-group { gap:4px; }
}
@media(max-width:400px) {
  .input-grid { grid-template-columns:1fr; }
  .input-grid .input-group:last-child { grid-column:auto; }
}

/* API MODAL */
#api-modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.88); z-index:400; align-items:center; justify-content:center; backdrop-filter:blur(6px); padding:20px; }
.api-box { background:#111; border:1px solid #222; border-radius:14px; padding:32px; width:100%; max-width:440px; }
.api-box h2 { font-family:'Bebas Neue',sans-serif; font-size:24px; letter-spacing:2px; margin-bottom:8px; }
.api-box p { color:var(--muted); font-size:13px; line-height:1.6; margin-bottom:20px; }
.api-box a { color:var(--accent); }
.api-box input { width:100%; background:var(--surface2); border:1px solid var(--border); border-radius:7px; padding:11px 13px; color:var(--text); font-family:'DM Mono',monospace; font-size:12px; outline:none; margin-bottom:6px; }
.api-box input:focus { border-color:var(--accent); }
.api-err { color:#f87171; font-size:11px; min-height:16px; margin-bottom:10px; }
.api-save { width:100%; background:var(--accent); color:white; border:none; border-radius:7px; padding:12px; font-family:'Bebas Neue',sans-serif; font-size:17px; letter-spacing:2px; cursor:pointer; }
.api-save:hover { background:#ff5500; }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div class="logo-mark">UE</div>
    <div>
      <div class="logo-text">Content Engine</div>
      <div class="logo-sub">Umesh Emmadishetty</div>
    </div>
  </div>
  <div class="header-right">
    <div class="date-chip" id="datechip"></div>
    <button class="key-btn" onclick="showApiModal()">üîë API Key</button>
  </div>
</header>

<main>
  <div class="hero">
    <h1>TODAY'S<br><span>IDEAS.</span></h1>
    <p>Fresh content ideas, scripts & teleprompter ‚Äî your full content workflow in one place.</p>
  </div>

  <div class="input-panel">
    <div class="input-panel-title">What are we generating today?</div>
    <div class="input-grid">
      <div class="input-group">
        <label>Content Focus</label>
        <select id="focusSelect">
          <option value="mixed">Mixed (Growth + Revenue)</option>
          <option value="growth">üöÄ Growth / Viral</option>
          <option value="revenue">üí∞ Revenue / Course Sales</option>
          <option value="mindset">Mindset & Belief Shifts</option>
          <option value="stock">Stock Market & Investing</option>
          <option value="digital">Digital Entrepreneurship</option>
          <option value="news">React to Today's News</option>
        </select>
      </div>
      <div class="input-group">
        <label>Week's Goal</label>
        <select id="goalSelect">
          <option value="growth">üìà Grow Subscribers</option>
          <option value="viral">üî• Go Viral</option>
          <option value="revenue">üí∞ Drive Enrollments</option>
          <option value="engagement">üí¨ Boost Engagement</option>
        </select>
      </div>
      <div class="input-group">
        <label>Ideas Count</label>
        <select id="countSelect">
          <option value="20">20 Ideas</option>
          <option value="30">30 Ideas</option>
          <option value="10">10 Quick</option>
        </select>
      </div>
    </div>
    <div class="input-group" style="margin-bottom:12px">
      <label>Today's Context (optional)</label>
      <textarea id="contextInput" placeholder="Paste today's news, a topic, or what's on your mind... e.g. 'Sensex fell 1500 points' or 'want to talk about why people quit SIPs'"></textarea>
    </div>
    <button class="gen-btn" id="genBtn" onclick="generateIdeas()">
      <span>‚ö°</span> GENERATE TODAY'S IDEAS
    </button>
  </div>

  <div class="error-box" id="errorBox"></div>

  <div class="loading" id="loading">
    <div class="spin"></div>
    <p>Analyzing your brand and generating fresh ideas...</p>
  </div>

  <div class="results" id="results">
    <div class="results-header">
      <h2>TODAY'S IDEAS</h2>
      <div class="results-meta" id="resultsMeta"></div>
    </div>
    <div id="ideasContainer"></div>
  </div>

  <div class="saved-section" id="savedSection">
    <h3>‚≠ê Saved Ideas</h3>
    <div class="saved-list" id="savedList"></div>
  </div>
</main>

<div class="toast" id="toast"></div>

<!-- Script Panel -->
<div class="script-overlay" id="spOverlay" onclick="closeScript()"></div>
<div class="script-panel" id="scriptPanel">
  <div class="sp-header">
    <div class="sp-title-box">
      <div class="sp-label">Writing Script For</div>
      <div class="sp-title" id="spTitle">‚Äî</div>
    </div>
    <button class="sp-close" onclick="closeScript()">‚úï</button>
  </div>
  <div class="sp-actions" id="spActions" style="display:none">
    <button class="sp-btn primary" onclick="copyFullScript()">üìã Copy Script</button>
    <button class="sp-btn" onclick="downloadScript()">‚¨áÔ∏è Download</button>
    <button class="sp-btn" onclick="regenScript()">üîÑ Regenerate</button>
    <button class="sp-btn tp" onclick="openTeleprompter()">üé¨ Teleprompter</button>
  </div>
  <div class="sp-body" id="spBody">
    <div class="sp-loading" id="spLoading">
      <div class="spin"></div>
      <p>Writing your 10-minute script...<br>Hook ¬∑ Story ¬∑ Solution ¬∑ CTA</p>
    </div>
    <div id="spContent" style="display:none"></div>
  </div>
  <div class="sp-footer" id="spFooter" style="display:none">
    <span>Words: <span class="sp-wc" id="spWc">‚Äî</span></span>
    <span id="spDuration">Duration: ‚Äî</span>
  </div>
</div>

<!-- Teleprompter -->
<div id="tp">
  <div id="tp-progress"><div id="tp-prog-fill"></div></div>
  <div id="tp-bar">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;color:var(--purple)">üé¨ TELEPROMPTER</div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <div class="tp-ctrl-group">
        <span class="tp-ctrl-label">SPEED</span>
        <button class="tp-btn" onclick="tpChangeSpeed(-0.5)">‚àí</button>
        <span class="tp-val" id="tpSpeedVal">1.0</span>
        <button class="tp-btn" onclick="tpChangeSpeed(0.5)">+</button>
      </div>
      <div class="tp-ctrl-group">
        <span class="tp-ctrl-label">SIZE</span>
        <button class="tp-btn" onclick="tpChangeSize(-2)">‚àí</button>
        <span class="tp-val" id="tpSizeVal">36</span>
        <button class="tp-btn" onclick="tpChangeSize(2)">+</button>
      </div>
      <button class="tp-btn" id="mirrorBtn" onclick="tpToggleMirror()" style="width:auto;padding:0 10px;font-size:10px;letter-spacing:1px;font-family:'DM Mono',monospace">‚ü∫ MIRROR</button>
      <button class="tp-exit" onclick="closeTeleprompter()">‚úï Exit</button>
    </div>
  </div>
  <div id="tp-fade-top"></div>
  <div id="tp-line"></div>
  <div id="tp-fade-bot"></div>
  <div id="tp-scroller">
    <div id="tp-text"></div>
  </div>
  <div id="tp-hint">SPACE TO PLAY ¬∑ ‚Üë‚Üì SPEED ¬∑ ESC EXIT</div>
  <div id="tp-controls">
    <button id="tp-play" onclick="tpTogglePlay()">‚ñ∂</button>
    <button class="tp-btn" onclick="tpReset()" title="Reset" style="width:36px;height:36px;border-radius:50%;font-size:14px">‚Ü∫</button>
    <span class="tp-time" id="tpTime">0:00 / ~0:00</span>
  </div>
</div>

<!-- SHORT SCRIPT PANEL -->
<div class="script-overlay" id="ssOverlay" onclick="closeShortScript()"></div>
<div class="script-panel" id="shortPanel">
  <div class="sp-header">
    <div class="sp-title-box">
      <div class="sp-label" style="color:var(--accent2)">‚ö° YOUTUBE SHORT SCRIPT</div>
      <div class="sp-title" id="ssTitle">‚Äî</div>
    </div>
    <button class="sp-close" onclick="closeShortScript()">‚úï</button>
  </div>
  <div class="sp-actions" id="ssActions" style="display:none">
    <button class="sp-btn primary" onclick="copyShortScript()">üìã Copy Script</button>
    <button class="sp-btn" onclick="downloadShortScript()">‚¨áÔ∏è Download</button>
    <button class="sp-btn" onclick="regenShortScript()">üîÑ Regenerate</button>
    <button class="sp-btn tp" onclick="openShortTeleprompter()">üé¨ Teleprompter</button>
  </div>
  <div class="sp-body" id="ssBody">
    <div class="sp-loading" id="ssLoading">
      <div class="spin"></div>
      <p>Writing your viral Short script...<br>Hook ¬∑ Punch ¬∑ CTA ¬∑ Under 60 sec</p>
    </div>
    <div id="ssContent" style="display:none"></div>
  </div>
  <div class="sp-footer" id="ssFooter" style="display:none">
    <span>Words: <span class="sp-wc" id="ssWc">‚Äî</span></span>
    <span id="ssDuration">Duration: ‚Äî</span>
  </div>
</div>

<!-- SHORT TELEPROMPTER (separate instance) -->
<div id="stp" style="position:fixed;inset:0;background:#000;z-index:310;display:none;flex-direction:column;overflow:hidden;">
  <div id="stp-progress" style="position:absolute;top:0;left:0;right:0;height:3px;background:#111;z-index:11">
    <div id="stp-prog-fill" style="height:100%;background:var(--accent2);width:0%;transition:width .15s"></div>
  </div>
  <div id="stp-bar" style="position:absolute;top:0;left:0;right:0;z-index:10;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;background:linear-gradient(to bottom,rgba(0,0,0,.95),transparent);transition:opacity .4s">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px;color:var(--accent2)">‚ö° SHORT TELEPROMPTER</div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
      <div class="tp-ctrl-group">
        <span class="tp-ctrl-label">SPEED</span>
        <button class="tp-btn" onclick="stpChangeSpeed(-0.5)">‚àí</button>
        <span class="tp-val" id="stpSpeedVal" style="color:var(--accent2)">1.0</span>
        <button class="tp-btn" onclick="stpChangeSpeed(0.5)">+</button>
      </div>
      <div class="tp-ctrl-group">
        <span class="tp-ctrl-label">SIZE</span>
        <button class="tp-btn" onclick="stpChangeSize(-2)">‚àí</button>
        <span class="tp-val" id="stpSizeVal" style="color:var(--accent2)">40</span>
        <button class="tp-btn" onclick="stpChangeSize(2)">+</button>
      </div>
      <button class="tp-exit" onclick="closeShortTeleprompter()">‚úï Exit</button>
    </div>
  </div>
  <div style="position:absolute;top:0;left:0;right:0;height:160px;background:linear-gradient(to bottom,#000,transparent);z-index:6;pointer-events:none"></div>
  <div style="position:absolute;bottom:0;left:0;right:0;height:160px;background:linear-gradient(to top,#000,transparent);z-index:6;pointer-events:none"></div>
  <div style="position:absolute;left:0;right:0;top:50%;height:1px;background:rgba(255,179,71,.1);z-index:5;pointer-events:none"></div>
  <div id="stp-scroller" style="height:100%;overflow:hidden;position:relative">
    <div id="stp-text" style="padding:50vh 8vw 80vh;max-width:820px;margin:0 auto;font-family:'DM Sans',sans-serif;font-size:40px;font-weight:400;line-height:1.85;color:#f0f0f0;will-change:transform"></div>
  </div>
  <div style="position:absolute;bottom:80px;left:50%;transform:translateX(-50%);font-size:10px;color:#2a2a2a;font-family:'DM Mono',monospace;letter-spacing:1px;pointer-events:none;white-space:nowrap">SPACE TO PLAY ¬∑ ‚Üë‚Üì SPEED ¬∑ ESC EXIT</div>
  <div id="stp-controls" style="position:absolute;bottom:0;left:0;right:0;z-index:10;padding:16px 20px;display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;background:linear-gradient(to top,rgba(0,0,0,.95),transparent);transition:opacity .4s">
    <button id="stp-play" onclick="stpTogglePlay()" style="background:var(--accent2);border:none;color:#000;width:52px;height:52px;border-radius:50%;cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;transition:all .15s;box-shadow:0 0 20px rgba(255,179,71,.3)">‚ñ∂</button>
    <button class="tp-btn" onclick="stpReset()" style="width:36px;height:36px;border-radius:50%;font-size:14px">‚Ü∫</button>
    <span class="tp-time" id="stpTime">0:00 / ~0:00</span>
  </div>
</div>

<!-- API Modal -->
<div id="api-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:400;align-items:center;justify-content:center;backdrop-filter:blur(6px);padding:20px">
  <div class="api-box">
    <h2>API KEY</h2>
    <p>Enter your Anthropic API key to power idea generation and script writing. Get yours at <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a>. Stored locally on your device only.</p>
    <input id="apiKeyInput" type="password" placeholder="sk-ant-api03-..." />
    <div class="api-err" id="apiErr"></div>
    <button class="api-save" onclick="saveApiKey()">SAVE & CONTINUE</button>
  </div>
</div>

<script>
//  INIT 
document.getElementById('datechip').textContent = new Date().toLocaleDateString('en-IN',{weekday:'short',day:'numeric',month:'short',year:'numeric'});

let apiKey = localStorage.getItem('ue_api_key') || '';
if (!apiKey) showApiModal();

function showApiModal() { document.getElementById('api-modal').style.display = 'flex'; }
function saveApiKey() {
  const v = document.getElementById('apiKeyInput').value.trim();
  if (!v.startsWith('sk-ant-')) { document.getElementById('apiErr').textContent = 'Key must start with sk-ant-...'; return; }
  apiKey = v;
  localStorage.setItem('ue_api_key', apiKey);
  document.getElementById('api-modal').style.display = 'none';
}

//  TOAST 
function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

//  HELPERS 
function escHtml(s) {
  if (!s) return '';
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}
function copyRaw(text) { navigator.clipboard.writeText(text).then(() => toast('Copied!')); }

// Index-based stores to avoid onclick injection
let ideaStore = [];
let ideaTypeStore = [];
function copyIdea(i) { copyRaw(ideaStore[i]); }
function saveIdeaByIndex(i) { saveIdea(ideaStore[i]); }
function writeScript(i) { openScript(ideaStore[i], ideaTypeStore[i]); }
function writeShortScript(i) { openShortScript(ideaStore[i]); }

//  SAVED IDEAS 
let savedIdeas = [];
function saveIdea(text) {
  if (savedIdeas.includes(text)) { toast('Already saved!'); return; }
  savedIdeas.push(text); renderSaved(); toast('Saved!');
}
function removeIdea(i) { savedIdeas.splice(i,1); renderSaved(); }
function renderSaved() {
  const sec = document.getElementById('savedSection');
  const list = document.getElementById('savedList');
  if (!savedIdeas.length) { sec.style.display='none'; return; }
  sec.style.display = 'block';
  let h = '';
  savedIdeas.forEach(function(idea, i) {
    h += '<div class="saved-item"><span>' + escHtml(idea) + '</span>';
    h += '<button class="chip-btn" onclick="copyRaw(savedIdeas[' + i + '])">Copy</button>';
    h += '<button class="rm-btn" onclick="removeIdea(' + i + ')">x</button></div>';
  });
  list.innerHTML = h;
}

//  GENERATE IDEAS 
async function generateIdeas() {
  const btn = document.getElementById('genBtn');
  const loading = document.getElementById('loading');
  const results = document.getElementById('results');
  const errorBox = document.getElementById('errorBox');
  const focus = document.getElementById('focusSelect').value;
  const goal = document.getElementById('goalSelect').value;
  const count = parseInt(document.getElementById('countSelect').value);
  const context = document.getElementById('contextInput').value.trim();

  btn.disabled = true;
  loading.style.display = 'block';
  results.style.display = 'none';
  errorBox.style.display = 'none';

  const focusLabels = {mixed:'Mixed Growth+Revenue',growth:'Growth/Viral',revenue:'Revenue/Course Sales',mindset:'Mindset & Belief Shifts',stock:'Stock Market & Investing',digital:'Digital Entrepreneurship',news:'Trending News Reaction'};

  const prompt = 'You are a content strategist for Umesh Emmadishetty, Telugu YouTube creator.\n\nCHANNEL: Telugu audience 20s-40s, financial freedom + digital entrepreneurship\nTOP VIDEO: "Save Yourself From Middle Class Trap" 94K views\nTONE: straight-talking big brother, no fluff, culturally Telugu\nTWO TYPES: GROWTH = mindset/viral | REVENUE = digital skills/courses\n\nFocus=' + focusLabels[focus] + ', Goal=' + goal + ', Count=' + count + '\n' + (context ? 'Context: ' + context : 'No context - generate evergreen ideas') + '\n\nTITLE RULES: Max 8 English words. Must have tension/villain/uncomfortable truth. NO generic titles.\n\nRespond ONLY with valid JSON (no markdown):\n{"videos":[{"title":"...","type":"growth|revenue","angle":"..."}],"shorts":[{"hook":"...","concept":"..."}],"hooks":["..."]}\n\nGenerate ' + Math.round(count*0.5) + ' videos, ' + Math.round(count*0.25) + ' shorts, ' + Math.round(count*0.25) + ' hooks.';

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:2000, messages:[{role:'user',content:prompt}]})
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error ? data.error.message : 'API error ' + res.status);
    const raw = data.content && data.content[0] ? data.content[0].text : '';
    const clean = raw.replace(/```json/g,'').replace(/```/g,'').trim();
    const parsed = JSON.parse(clean);
    renderIdeas(parsed);
  } catch(err) {
    if (err.message && err.message.indexOf('401') !== -1) {
      errorBox.innerHTML = 'Invalid API key. <a href="#" onclick="showApiModal()" style="color:var(--accent)">Update</a>';
    } else {
      errorBox.textContent = 'Error: ' + (err.message || 'Something went wrong.');
    }
    errorBox.style.display = 'block';
  } finally {
    btn.disabled = false;
    loading.style.display = 'none';
  }
}

function renderIdeas(data) {
  const container = document.getElementById('ideasContainer');
  const results = document.getElementById('results');
  const total = (data.videos ? data.videos.length : 0) + (data.shorts ? data.shorts.length : 0) + (data.hooks ? data.hooks.length : 0);
  document.getElementById('resultsMeta').textContent = total + ' ideas  ' + new Date().toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});

  ideaStore = []; ideaTypeStore = [];
  let html = '';

  if (data.videos && data.videos.length) {
    html += '<div class="section"><div class="section-header"><span class="section-icon">Video</span><span class="section-title">Video Titles</span><span class="section-count">' + data.videos.length + '</span></div><div class="ideas-grid">';
    data.videos.forEach(function(v) {
      const idx = ideaStore.length;
      ideaStore.push(v.title);
      ideaTypeStore.push(v.type || 'neutral');
      const cls = v.type === 'growth' ? 'growth' : v.type === 'revenue' ? 'revenue' : 'neutral';
      const lbl = v.type === 'growth' ? 'Growth' : v.type === 'revenue' ? 'Revenue' : '-';
      html += '<div class="idea-card ' + cls + '">';
      html += '<span class="idea-type ' + cls + '">' + lbl + '</span>';
      html += '<div style="flex:1">';
      html += '<div class="idea-text">' + escHtml(v.title) + '</div>';
      if (v.angle) html += '<div class="idea-angle">' + escHtml(v.angle) + '</div>';
      html += '<div class="idea-actions">';
      html += '<button class="chip-btn" onclick="copyIdea(' + idx + ')">Copy</button>';
      html += '<button class="chip-btn" onclick="saveIdeaByIndex(' + idx + ')">Save</button>';
      html += '<button class="chip-btn script" onclick="writeScript(' + idx + ')">Write Script</button>';
      html += '</div></div></div>';
    });
    html += '</div></div>';
  }

  if (data.shorts && data.shorts.length) {
    html += '<div class="section"><div class="section-header"><span class="section-icon">Short</span><span class="section-title">YouTube Shorts</span><span class="section-count">' + data.shorts.length + '</span></div><div class="shorts-grid">';
    data.shorts.forEach(function(s) {
      const idx = ideaStore.length;
      ideaStore.push(s.hook);
      ideaTypeStore.push('neutral');
      html += '<div class="short-card">';
      html += '<div class="micro-label">Hook</div>';
      html += '<div class="short-hook">' + escHtml(s.hook) + '</div>';
      html += '<div class="micro-label">Concept</div>';
      html += '<div class="short-concept">' + escHtml(s.concept) + '</div>';
      html += '<div class="idea-actions" style="margin-top:8px">';
      html += '<button class="chip-btn" onclick="copyIdea(' + idx + ')">Copy</button>';
      html += '<button class="chip-btn" onclick="saveIdeaByIndex(' + idx + ')">Save</button>';
      html += '<button class="chip-btn script" onclick="writeShortScript(' + idx + ')">Short Script</button>';
      html += '</div></div>';
    });
    html += '</div></div>';
  }

  if (data.hooks && data.hooks.length) {
    html += '<div class="section"><div class="section-header"><span class="section-icon">Hook</span><span class="section-title">Opening Hooks</span><span class="section-count">' + data.hooks.length + '</span></div><div class="hooks-list">';
    data.hooks.forEach(function(h) {
      const idx = ideaStore.length;
      ideaStore.push(h);
      ideaTypeStore.push('neutral');
      html += '<div class="hook-card">';
      html += escHtml(h);
      html += '<div class="idea-actions" style="margin-top:7px">';
      html += '<button class="chip-btn" onclick="copyIdea(' + idx + ')">Copy</button>';
      html += '<button class="chip-btn" onclick="saveIdeaByIndex(' + idx + ')">Save</button>';
      html += '</div></div>';
    });
    html += '</div></div>';
  }

  container.innerHTML = html;
  results.style.display = 'block';
  results.scrollIntoView({behavior:'smooth', block:'start'});
}

//  LONG FORM SCRIPT PANEL 
let currentScriptTitle = '';
let currentScriptType = '';
let currentScriptRaw = '';

function openScript(title, type) {
  currentScriptTitle = title;
  currentScriptType = type;
  currentScriptRaw = '';
  document.getElementById('spTitle').textContent = title;
  document.getElementById('spActions').style.display = 'none';
  document.getElementById('spFooter').style.display = 'none';
  document.getElementById('spContent').style.display = 'none';
  document.getElementById('spLoading').style.display = 'flex';
  document.getElementById('spOverlay').style.display = 'block';
  document.getElementById('scriptPanel').classList.add('open');
  document.body.style.overflow = 'hidden';
  fetchScript(title, type);
}

function closeScript() {
  document.getElementById('scriptPanel').classList.remove('open');
  document.getElementById('spOverlay').style.display = 'none';
  document.body.style.overflow = '';
}

function regenScript() { openScript(currentScriptTitle, currentScriptType); }
function copyFullScript() { copyRaw(currentScriptRaw); }
function downloadScript() {
  const blob = new Blob([currentScriptRaw], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'script.txt';
  a.click(); toast('Downloaded!');
}

async function fetchScript(title, type) {
  const ctype = type === 'growth' ? 'GROWTH (viral/mindset)' : type === 'revenue' ? 'REVENUE (course sales)' : 'MIXED';
  const prompt = 'Write a YouTube video script for Umesh Emmadishetty, Telugu creator.\n\nVIDEO: "' + title + '"\nTYPE: ' + ctype + '\nAUDIENCE: Telugu 20s-40s, middle class, want financial freedom\nTONE: straight-talking big brother, Telugu+English code-switching, spoken voice\n\nWrite COMPLETE 7-part script, 1450-1600 words total (~10-12 min).\n\nUse these EXACT section headers:\n[PART 1 - HOOK | 0:00-0:45 | ~100 words]\n[PART 2 - PROBLEM DEEPENER | 0:45-2:30 | ~250 words]\n[PART 3 - VILLAIN REVEAL | 2:30-4:00 | ~200 words]\n[PART 4 - STORY/PROOF | 4:00-6:30 | ~300 words]\n[PART 5 - SOLUTION | 6:30-8:30 | ~350 words]\n[PART 6 - CALLBACK | 8:30-9:30 | ~150 words]\n[PART 7 - CTA | 9:30-10:00 | ~100 words]\n\nRules: NEVER start with Namaskar. Mix Telugu+English. Use [director note] for cues. Real numbers in Part 4.';

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:4000, messages:[{role:'user',content:prompt}]})
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error ? data.error.message : 'API error');
    currentScriptRaw = data.content && data.content[0] ? data.content[0].text : '';
    renderScript(currentScriptRaw);
  } catch(err) {
    document.getElementById('spLoading').innerHTML = '<p style="color:#f87171">Error: ' + escHtml(err.message) + '<br><br><button class="sp-btn primary" onclick="regenScript()">Try Again</button></p>';
  }
}

function renderScript(text) {
  var partColors = ['#ff6b2b','#ffb347','#22c55e','#60a5fa','#a78bfa','#f472b6','#34d399'];
  var headerMatches = [];
  var re = /\[PART \d+[^\]]*\]/gi;
  var m;
  while ((m = re.exec(text)) !== null) headerMatches.push(m[0]);
  var bodies = text.split(/\[PART \d+[^\]]*\]/i).slice(1);

  var html = '';
  if (headerMatches.length === 0) {
    html = '<div style="font-size:13px;line-height:1.9;color:#ccc;white-space:pre-wrap">' + escHtml(text) + '</div>';
  } else {
    headerMatches.forEach(function(h, i) {
      var color = partColors[i % partColors.length];
      var label = h.replace(/\[|\]/g,'').split('|')[0].replace(/PART \d+ [-] /i,'').trim();
      var timing = (h.match(/\d+:\d+\s*[-]\s*\d+:\d+/) || [''])[0];
      var body = bodies[i] ? bodies[i].trim() : '';
      var fmtBody = escHtml(body)
        .replace(/\*\*(.*?)\*\*/g, '<b style="color:#ffb347">$1</b>')
        .replace(/\[([^\]]*)\]/g, '<i style="color:#555;font-size:11px">[$1]</i>');
      html += '<div class="script-part">';
      html += '<div class="part-head">';
      html += '<span class="part-badge">Part ' + (i+1) + '</span>';
      html += '<span class="part-name" style="color:' + color + '">' + escHtml(label) + '</span>';
      if (timing) html += '<span class="part-timing">' + timing + '</span>';
      html += '</div>';
      html += '<div class="script-text">' + fmtBody + '</div>';
      html += '</div><div class="part-divider"></div>';
    });
  }

  document.getElementById('spContent').innerHTML = html;
  var wc = text.split(/\s+/).filter(Boolean).length;
  var mins = Math.round(wc/140);
  document.getElementById('spWc').textContent = wc.toLocaleString();
  document.getElementById('spDuration').textContent = '~' + mins + ' min';
  document.getElementById('spFooter').style.display = 'flex';
  document.getElementById('spLoading').style.display = 'none';
  document.getElementById('spContent').style.display = 'block';
  document.getElementById('spActions').style.display = 'flex';
}

//  SHORT SCRIPT PANEL 
let currentShortRaw = '';
let currentShortHook = '';

function openShortScript(hook) {
  currentShortHook = hook;
  currentShortRaw = '';
  document.getElementById('ssTitle').textContent = hook;
  document.getElementById('ssActions').style.display = 'none';
  document.getElementById('ssFooter').style.display = 'none';
  document.getElementById('ssContent').style.display = 'none';
  document.getElementById('ssLoading').style.display = 'flex';
  document.getElementById('ssOverlay').style.display = 'block';
  document.getElementById('shortPanel').classList.add('open');
  document.body.style.overflow = 'hidden';
  fetchShortScript(hook);
}

function closeShortScript() {
  document.getElementById('shortPanel').classList.remove('open');
  document.getElementById('ssOverlay').style.display = 'none';
  document.body.style.overflow = '';
}

function regenShortScript() { openShortScript(currentShortHook); }
function copyShortScript() { copyRaw(currentShortRaw); }
function downloadShortScript() {
  var blob = new Blob([currentShortRaw], {type:'text/plain'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'short_script.txt';
  a.click(); toast('Downloaded!');
}

async function fetchShortScript(hook) {
  const prompt = 'You are an elite 8-figure YouTube Shorts scriptwriter. Write a viral Shorts script.\n\nHOOK: "' + hook + '"\nCREATOR: Umesh Emmadishetty - Telugu creator, straight-talking big brother\nAUDIENCE: Telugu 20s-40s, want financial freedom\nTONE: Mix Telugu+English naturally. Under 60 seconds (~130-150 words).\n\nFORMAT - use these EXACT labels:\n[PATTERN INTERRUPT]\n[CREDIBILITY]\n[CORE INSIGHT]\n[REFRAME]\n[CTA]\n\nAdd (PAUSE), (SLOW), (DIRECT CAM) cues where needed.\nONE powerful idea only. Short sentences. Every word earns its place.\n\nWrite the script:';

  try {
    const res = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': apiKey,
        'anthropic-version': '2023-06-01',
        'anthropic-dangerous-direct-browser-access': 'true'
      },
      body: JSON.stringify({model:'claude-sonnet-4-20250514', max_tokens:1500, messages:[{role:'user',content:prompt}]})
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error ? data.error.message : 'API error');
    currentShortRaw = data.content && data.content[0] ? data.content[0].text : '';
    renderShortScript(currentShortRaw);
  } catch(err) {
    document.getElementById('ssLoading').innerHTML = '<p style="color:#f87171">Error: ' + escHtml(err.message) + '<br><br><button class="sp-btn primary" onclick="regenShortScript()">Try Again</button></p>';
  }
}

function renderShortScript(text) {
  var sectionColors = {'PATTERN INTERRUPT':'#ff6b2b','CREDIBILITY':'#ffb347','CORE INSIGHT':'#22c55e','REFRAME':'#60a5fa','CTA':'#a78bfa'};
  var timings = {'PATTERN INTERRUPT':'0-3 sec','CREDIBILITY':'3-8 sec','CORE INSIGHT':'8-45 sec','REFRAME':'45-55 sec','CTA':'55-60 sec'};
  var headerRe = /\[(PATTERN INTERRUPT|CREDIBILITY(?: SPIKE)?|CORE INSIGHT|REFRAME|CTA)\]/gi;
  var headers = [];
  var m;
  while ((m = headerRe.exec(text)) !== null) headers.push(m[0].replace(/\[|\]/g,'').replace(' SPIKE',''));
  var bodies = text.split(/\[(PATTERN INTERRUPT|CREDIBILITY(?: SPIKE)?|CORE INSIGHT|REFRAME|CTA)\]/i).filter(function(s,i){ return i % 2 === 0; }).slice(1);

  var wc = text.split(/\s+/).filter(Boolean).length;
  var secs = Math.round(wc / (140/60));
  var isOk = secs <= 60;

  var html = '<div style="background:' + (isOk ? 'rgba(34,197,94,.08)' : 'rgba(245,158,11,.08)') + ';border:1px solid ' + (isOk ? 'rgba(34,197,94,.2)' : 'rgba(245,158,11,.2)') + ';border-radius:7px;padding:10px 14px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between">';
  html += '<span style="font-size:12px;color:' + (isOk ? 'var(--growth)' : 'var(--revenue)') + '">' + secs + ' seconds ' + (isOk ? '- Under 60 sec' : '- Over 60 sec, trim needed') + '</span>';
  html += '<span style="font-size:11px;color:var(--muted);font-family:\'DM Mono\',monospace">' + wc + ' words</span></div>';

  if (headers.length === 0) {
    var fmtText = escHtml(text)
      .replace(/\(PAUSE\)/g, '<span style="color:var(--muted);font-size:11px;font-style:italic"> (PAUSE) </span>')
      .replace(/\(DIRECT CAM\)/g, '<span style="color:var(--accent2);font-size:11px"> (CAM) </span>');
    html += '<div style="font-size:14px;line-height:1.9;color:#ccc;white-space:pre-wrap;border-left:2px solid var(--border);padding-left:14px">' + fmtText + '</div>';
  } else {
    headers.forEach(function(h, i) {
      var color = sectionColors[h] || '#666';
      var body = bodies[i] ? bodies[i].trim() : '';
      var fmtBody = escHtml(body)
        .replace(/\(PAUSE\)/g, '<span style="color:var(--muted);font-size:11px;font-style:italic"> (PAUSE) </span>')
        .replace(/\(SLOW\)/g, '<span style="color:var(--muted);font-size:11px;font-style:italic"> (SLOW) </span>')
        .replace(/\(DIRECT CAM\)/g, '<span style="color:var(--accent2);font-size:11px"> (CAM) </span>')
        .replace(/\*\*(.*?)\*\*/g, '<b style="color:var(--accent2)">$1</b>');
      html += '<div class="script-part">';
      html += '<div class="part-head">';
      html += '<span class="part-badge" style="border-color:' + color + '44;color:' + color + '">' + escHtml(h) + '</span>';
      html += '<span class="part-timing">' + (timings[h] || '') + '</span>';
      html += '</div>';
      html += '<div class="script-text" style="border-left-color:' + color + '44;font-size:15px;line-height:2">' + fmtBody + '</div>';
      html += '</div><div class="part-divider"></div>';
    });
  }

  document.getElementById('ssContent').innerHTML = html;
  document.getElementById('ssWc').textContent = wc + ' words';
  document.getElementById('ssDuration').textContent = '~' + secs + ' sec';
  document.getElementById('ssFooter').style.display = 'flex';
  document.getElementById('ssLoading').style.display = 'none';
  document.getElementById('ssContent').style.display = 'block';
  document.getElementById('ssActions').style.display = 'flex';
}

//  TELEPROMPTER (Long Form) 
var tpPlaying = false, tpSpeed = 1.0, tpFontSize = 36, tpPos = 0;
var tpRaf = null, tpTotal = 0, tpHideTimer = null, tpMirrored = false;

function openTeleprompter() {
  if (!currentScriptRaw) { toast('Generate a script first!'); return; }
  var lines = currentScriptRaw
    .replace(/\[PART (\d+)[^\]]*\]/gi, '\nPART_LABEL_$1\n')
    .replace(/\*\*(.*?)\*\*/g,'$1')
    .replace(/\*(.*?)\*/g,'$1')
    .replace(/\[[^\]]*\]/g,'')
    .split('\n');
  var html = '';
  lines.forEach(function(line) {
    var t = line.trim();
    if (!t) return;
    if (t.indexOf('PART_LABEL_') === 0) {
      html += '<span class="tp-section-label">PART ' + escHtml(t.replace('PART_LABEL_','')) + '</span>';
    } else {
      html += '<p>' + escHtml(t) + '</p>';
    }
  });
  document.getElementById('tp-text').innerHTML = html;
  document.getElementById('tp-text').style.fontSize = tpFontSize + 'px';
  document.getElementById('tp-text').style.transform = '';
  document.getElementById('tpSpeedVal').textContent = tpSpeed.toFixed(1);
  document.getElementById('tpSizeVal').textContent = tpFontSize;
  document.getElementById('mirrorBtn').style.color = '';
  tpMirrored = false;
  tpPos = 0; tpPlaying = false;
  document.getElementById('tp-text').style.transform = 'translateY(0)';
  document.getElementById('tp-prog-fill').style.width = '0%';
  document.getElementById('tp-play').textContent = 'Play';
  document.getElementById('tp-play').classList.remove('playing');
  document.getElementById('tp').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  setTimeout(function() {
    var tpEl = document.getElementById('tp-text');
    var vpH = document.getElementById('tp-scroller').clientHeight;
    tpTotal = Math.max(0, tpEl.scrollHeight - vpH);
    tpUpdateTime();
  }, 150);
  document.addEventListener('keydown', tpKeyHandler);
  tpShowControls();
}

function closeTeleprompter() {
  tpPlaying = false; clearInterval(tpRaf);
  document.getElementById('tp').style.display = 'none';
  document.body.style.overflow = '';
  document.removeEventListener('keydown', tpKeyHandler);
}

function tpKeyHandler(e) {
  if (document.getElementById('tp').style.display === 'none') return;
  if (e.code === 'Space') { e.preventDefault(); tpTogglePlay(); }
  if (e.code === 'ArrowUp') tpChangeSpeed(0.5);
  if (e.code === 'ArrowDown') tpChangeSpeed(-0.5);
  if (e.code === 'Escape') closeTeleprompter();
}

function tpShowControls() {
  document.getElementById('tp-bar').style.opacity = '1';
  document.getElementById('tp-controls').style.opacity = '1';
  document.getElementById('tp-hint').style.opacity = '1';
  clearTimeout(tpHideTimer);
  tpHideTimer = setTimeout(function() {
    if (tpPlaying) {
      document.getElementById('tp-bar').style.opacity = '0';
      document.getElementById('tp-controls').style.opacity = '0';
      document.getElementById('tp-hint').style.opacity = '0';
    }
  }, 3000);
}

document.getElementById('tp').addEventListener('mousemove', tpShowControls);
document.getElementById('tp').addEventListener('touchstart', tpShowControls, {passive:true});

function tpTogglePlay() {
  tpPlaying = !tpPlaying;
  var btn = document.getElementById('tp-play');
  btn.textContent = tpPlaying ? 'Pause' : 'Play';
  if (tpPlaying) { btn.classList.add('playing'); clearInterval(tpRaf); tpRaf = setInterval(tpTick, 16); }
  else { btn.classList.remove('playing'); clearInterval(tpRaf); }
}

function tpTick() {
  if (!tpPlaying) { clearInterval(tpRaf); return; }
  tpPos += (tpSpeed * 60 * 16) / 1000;
  if (tpPos > tpTotal) tpPos = tpTotal;
  document.getElementById('tp-text').style.transform = 'translateY(-' + tpPos + 'px)';
  document.getElementById('tp-prog-fill').style.width = (tpTotal > 0 ? Math.min((tpPos/tpTotal)*100,100) : 0) + '%';
  tpUpdateTime();
  if (tpPos >= tpTotal - 2) {
    tpPlaying = false; clearInterval(tpRaf);
    document.getElementById('tp-play').textContent = 'Play';
    document.getElementById('tp-play').classList.remove('playing');
    tpShowControls();
  }
}

function tpReset() {
  tpPlaying = false; clearInterval(tpRaf); tpPos = 0;
  document.getElementById('tp-text').style.transform = 'translateY(0)';
  document.getElementById('tp-prog-fill').style.width = '0%';
  document.getElementById('tp-play').textContent = 'Play';
  document.getElementById('tp-play').classList.remove('playing');
  tpUpdateTime();
}

function tpChangeSpeed(d) {
  tpSpeed = Math.max(0.5, Math.min(3.0, Math.round((tpSpeed+d)*10)/10));
  document.getElementById('tpSpeedVal').textContent = tpSpeed.toFixed(1);
}

function tpChangeSize(d) {
  tpFontSize = Math.max(18, Math.min(72, tpFontSize+d));
  document.getElementById('tpSizeVal').textContent = tpFontSize;
  document.getElementById('tp-text').style.fontSize = tpFontSize + 'px';
  setTimeout(function() { var el = document.getElementById('tp-text'); tpTotal = Math.max(0, el.scrollHeight - document.getElementById('tp-scroller').clientHeight); }, 50);
}

function tpToggleMirror() {
  tpMirrored = !tpMirrored;
  document.getElementById('tp-scroller').style.transform = tpMirrored ? 'scaleX(-1)' : '';
  document.getElementById('mirrorBtn').style.color = tpMirrored ? 'var(--purple)' : '';
}

function tpUpdateTime() {
  var wc = currentScriptRaw.split(/\s+/).filter(Boolean).length;
  var totalS = Math.round(wc / (140/60));
  var elapsedS = tpTotal > 0 ? Math.round((tpPos/tpTotal)*totalS) : 0;
  function fmt(s) { return Math.floor(s/60) + ':' + String(s%60).padStart(2,'0'); }
  document.getElementById('tpTime').textContent = fmt(elapsedS) + ' / ~' + fmt(totalS);
}

//  SHORT TELEPROMPTER 
var stpPlaying = false, stpSpeed = 1.0, stpFontSize = 40, stpPos = 0;
var stpRaf = null, stpTotal = 0, stpHideTimer = null;

function openShortTeleprompter() {
  if (!currentShortRaw) { toast('Generate a Short script first!'); return; }
  var lines = currentShortRaw
    .replace(/\[(PATTERN INTERRUPT|CREDIBILITY(?: SPIKE)?|CORE INSIGHT|REFRAME|CTA)\]/gi, '\nSEC_LABEL_$1\n')
    .replace(/\*\*(.*?)\*\*/g,'$1')
    .replace(/\*(.*?)\*/g,'$1')
    .split('\n');
  var html = '';
  lines.forEach(function(line) {
    var t = line.trim();
    if (!t) return;
    if (t.indexOf('SEC_LABEL_') === 0) {
      html += '<span style="font-family:\'Bebas Neue\',sans-serif;font-size:.55em;letter-spacing:3px;color:var(--accent2);margin:1em 0 .3em;opacity:.6;display:block">' + escHtml(t.replace('SEC_LABEL_','')) + '</span>';
    } else if (t === '(PAUSE)') {
      html += '<span style="display:block;font-size:.4em;color:#333;letter-spacing:2px;font-family:\'DM Mono\',monospace;margin:.3em 0">- PAUSE -</span>';
    } else if (t === '(DIRECT CAM)') {
      html += '<span style="display:block;font-size:.4em;color:#ff6b2b55;letter-spacing:2px;font-family:\'DM Mono\',monospace;margin:.3em 0">CAM</span>';
    } else {
      html += '<p style="margin:0 0 .5em">' + escHtml(t) + '</p>';
    }
  });
  document.getElementById('stp-text').innerHTML = html;
  document.getElementById('stp-text').style.fontSize = stpFontSize + 'px';
  document.getElementById('stpSpeedVal').textContent = stpSpeed.toFixed(1);
  document.getElementById('stpSizeVal').textContent = stpFontSize;
  stpPos = 0; stpPlaying = false;
  document.getElementById('stp-text').style.transform = 'translateY(0)';
  document.getElementById('stp-prog-fill').style.width = '0%';
  document.getElementById('stp-play').textContent = 'Play';
  document.getElementById('stp').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  setTimeout(function() {
    var stpEl = document.getElementById('stp-text');
    var stpVpH = document.getElementById('stp-scroller').clientHeight;
    stpTotal = Math.max(0, stpEl.scrollHeight - stpVpH);
    stpUpdateTime();
  }, 150);
  document.addEventListener('keydown', stpKeyHandler);
  stpShowControls();
}

function closeShortTeleprompter() {
  stpPlaying = false; clearInterval(stpRaf);
  document.getElementById('stp').style.display = 'none';
  document.body.style.overflow = '';
  document.removeEventListener('keydown', stpKeyHandler);
}

function stpKeyHandler(e) {
  if (document.getElementById('stp').style.display === 'none') return;
  if (e.code === 'Space') { e.preventDefault(); stpTogglePlay(); }
  if (e.code === 'ArrowUp') stpChangeSpeed(0.5);
  if (e.code === 'ArrowDown') stpChangeSpeed(-0.5);
  if (e.code === 'Escape') closeShortTeleprompter();
}

function stpShowControls() {
  document.getElementById('stp-bar').style.opacity = '1';
  document.getElementById('stp-controls').style.opacity = '1';
  clearTimeout(stpHideTimer);
  stpHideTimer = setTimeout(function() {
    if (stpPlaying) {
      document.getElementById('stp-bar').style.opacity = '0';
      document.getElementById('stp-controls').style.opacity = '0';
    }
  }, 3000);
}

document.getElementById('stp').addEventListener('mousemove', stpShowControls);
document.getElementById('stp').addEventListener('touchstart', stpShowControls, {passive:true});

function stpTogglePlay() {
  stpPlaying = !stpPlaying;
  document.getElementById('stp-play').textContent = stpPlaying ? 'Pause' : 'Play';
  if (stpPlaying) { clearInterval(stpRaf); stpRaf = setInterval(stpTick, 16); }
  else clearInterval(stpRaf);
}

function stpTick() {
  if (!stpPlaying) { clearInterval(stpRaf); return; }
  stpPos += (stpSpeed * 60 * 16) / 1000;
  if (stpPos > stpTotal) stpPos = stpTotal;
  document.getElementById('stp-text').style.transform = 'translateY(-' + stpPos + 'px)';
  document.getElementById('stp-prog-fill').style.width = (stpTotal > 0 ? Math.min((stpPos/stpTotal)*100,100) : 0) + '%';
  stpUpdateTime();
  if (stpPos >= stpTotal - 2) {
    stpPlaying = false; clearInterval(stpRaf);
    document.getElementById('stp-play').textContent = 'Play';
    stpShowControls();
  }
}

function stpReset() {
  stpPlaying = false; clearInterval(stpRaf); stpPos = 0;
  document.getElementById('stp-text').style.transform = 'translateY(0)';
  document.getElementById('stp-prog-fill').style.width = '0%';
  document.getElementById('stp-play').textContent = 'Play';
  stpUpdateTime();
}

function stpChangeSpeed(d) {
  stpSpeed = Math.max(0.5, Math.min(3.0, Math.round((stpSpeed+d)*10)/10));
  document.getElementById('stpSpeedVal').textContent = stpSpeed.toFixed(1);
}

function stpChangeSize(d) {
  stpFontSize = Math.max(18, Math.min(80, stpFontSize+d));
  document.getElementById('stpSizeVal').textContent = stpFontSize;
  document.getElementById('stp-text').style.fontSize = stpFontSize + 'px';
  setTimeout(function() { var el = document.getElementById('stp-text'); stpTotal = Math.max(0, el.scrollHeight - document.getElementById('stp-scroller').clientHeight); }, 50);
}

function stpUpdateTime() {
  var wc = currentShortRaw.split(/\s+/).filter(Boolean).length;
  var totalS = Math.round(wc/(140/60));
  var elapsedS = stpTotal > 0 ? Math.round((stpPos/stpTotal)*totalS) : 0;
  function fmt(s) { return Math.floor(s/60) + ':' + String(s%60).padStart(2,'0'); }
  document.getElementById('stpTime').textContent = fmt(elapsedS) + ' / ~' + fmt(totalS);
}
</script>
</body>
</html>
